<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault Contents - GhostVault</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
    <div class="container py-4">
        <div class="row">
            <div class="col-12">
                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2>
                            {% if vault_type == 'real' %}
                                <i class="fas fa-shield-alt text-success me-2"></i>
                                Real Vault
                            {% elif vault_type == 'decoy' %}
                                <i class="fas fa-mask text-info me-2"></i>
                                Decoy Vault
                            {% else %}
                                <i class="fas fa-vault text-secondary me-2"></i>
                                {{ vault_type|title }} Vault
                            {% endif %}
                        </h2>
                        <p class="text-muted mb-0">{{ metadata.name or 'Vault Contents' }}</p>
                    </div>
                    <div>
                        <a href="{{ url_for('logout') }}" class="btn btn-outline-warning me-2">
                            <i class="fas fa-sign-out-alt me-2"></i>
                            Logout
                        </a>
                        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-home me-2"></i>
                            Home
                        </a>
                    </div>
                </div>

                <!-- Vault Type Indicator -->
                {% if vault_type == 'decoy' %}
                    <div class="alert alert-info border-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>This is a decoy vault</strong> - Contents are for plausible deniability only
                    </div>
                {% elif vault_type == 'real' %}
                    <div class="alert alert-success border-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Real vault unlocked</strong> - Your actual sensitive data is displayed below
                    </div>
                {% endif %}

                <!-- Vault Contents -->
                <div class="card bg-secondary mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-folder-open me-2"></i>
                            Files ({{ contents|length }})
                        </h5>
                        <div class="text-muted small">
                            Total: {{ metadata.file_count or contents|length }} files
                        </div>
                    </div>
                    <div class="card-body p-0">
                        {% if contents %}
                            <div class="table-responsive">
                                <table class="table table-dark table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th><i class="fas fa-file me-2"></i>Filename</th>
                                            <th><i class="fas fa-tag me-2"></i>Type</th>
                                            <th><i class="fas fa-weight me-2"></i>Size</th>
                                            <th><i class="fas fa-download me-2"></i>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for filename, file_info in contents.items() %}
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        {% if file_info.type == 'text' %}
                                                            <i class="fas fa-file-alt text-info me-2"></i>
                                                        {% elif file_info.type == 'image' %}
                                                            <i class="fas fa-file-image text-success me-2"></i>
                                                        {% elif file_info.type == 'document' %}
                                                            <i class="fas fa-file-pdf text-danger me-2"></i>
                                                        {% else %}
                                                            <i class="fas fa-file text-secondary me-2"></i>
                                                        {% endif %}
                                                        <span>{{ filename }}</span>
                                                    </div>
                                                </td>
                                                <td>
                                                    <span class="badge bg-{{ 'info' if file_info.type == 'text' else 'success' if file_info.type == 'image' else 'danger' if file_info.type == 'document' else 'secondary' }}">
                                                        {{ file_info.type|title }}
                                                    </span>
                                                </td>
                                                <td class="text-muted">{{ file_info.size_human }}</td>
                                                <td>
                                                    <a href="{{ url_for('download_file', blob_id=session.blob_id, filename=filename) }}" 
                                                       class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-download me-1"></i>
                                                        Download
                                                    </a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center py-5">
                                <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">No files in this vault</h5>
                                <p class="text-muted">This vault appears to be empty.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Audit Log (Real Vault Only) -->
                {% if vault_type == 'real' and audit_entries %}
                    <div class="card bg-secondary">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-clipboard-list text-warning me-2"></i>
                                Access Audit Log
                            </h5>
                            <small class="text-muted">Security log of all unlock attempts</small>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-dark table-sm mb-0">
                                    <thead class="sticky-top">
                                        <tr>
                                            <th>Timestamp</th>
                                            <th>Password Token</th>
                                            <th>Result</th>
                                            <th>Vault Type</th>
                                            <th>Source</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for entry in audit_entries[:20] %}
                                            <tr>
                                                <td class="text-muted small">
                                                    {{ entry.datetime }}
                                                </td>
                                                <td class="font-monospace small">
                                                    {{ entry.password_token }}
                                                </td>
                                                <td>
                                                    {% if entry.success %}
                                                        <span class="badge bg-success">
                                                            <i class="fas fa-check me-1"></i>Success
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-danger">
                                                            <i class="fas fa-times me-1"></i>Failed
                                                        </span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if entry.vault_type %}
                                                        <span class="badge bg-{{ 'success' if entry.vault_type == 'real' else 'info' if entry.vault_type == 'decoy' else 'danger' }}">
                                                            {{ entry.vault_type|title }}
                                                        </span>
                                                    {% else %}
                                                        <span class="text-muted">-</span>
                                                    {% endif %}
                                                </td>
                                                <td class="text-muted small">
                                                    {{ entry.ip_address }}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% if audit_entries|length > 20 %}
                                <div class="card-footer text-center">
                                    <small class="text-muted">Showing last 20 entries ({{ audit_entries|length }} total)</small>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}

                <!-- Security Information -->
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card bg-dark border-info h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-lock fa-2x text-info mb-3"></i>
                                <h6>Encryption</h6>
                                <p class="small text-muted mb-0">
                                    AES-256-GCM with Argon2 key derivation
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-dark border-warning h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-shield-alt fa-2x text-warning mb-3"></i>
                                <h6>Protection</h6>
                                <p class="small text-muted mb-0">
                                    Brute force protection with self-destruct
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-dark border-success h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-eye-slash fa-2x text-success mb-3"></i>
                                <h6>Privacy</h6>
                                <p class="small text-muted mb-0">
                                    Decoy vaults provide plausible deniability
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="text-center mt-4">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-info" onclick="location.reload()">
                            <i class="fas fa-sync-alt me-2"></i>
                            Refresh
                        </button>
                        <a href="{{ url_for('unlock_vault') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-key me-2"></i>
                            Try Different Password
                        </a>
                        <a href="{{ url_for('logout') }}" class="btn btn-outline-warning">
                            <i class="fas fa-sign-out-alt me-2"></i>
                            Secure Logout
                        </a>
                    </div>
                </div>

                <!-- Footer Warning -->
                <div class="alert alert-dark border-secondary mt-4">
                    <div class="row">
                        <div class="col-md-8">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                            <strong>Security Notice:</strong> 
                            Remember to log out securely when finished. All access is being logged for security purposes.
                        </div>
                        <div class="col-md-4 text-md-end">
                            <small class="text-muted">
                                Session: {{ vault_type|title }} Vault Active
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto-logout after inactivity (30 minutes)
        let inactivityTimer;
        const INACTIVITY_TIME = 30 * 60 * 1000; // 30 minutes

        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                alert('Session expired due to inactivity. You will be logged out for security.');
                window.location.href = '{{ url_for("logout") }}';
            }, INACTIVITY_TIME);
        }

        // Reset timer on user activity
        document.addEventListener('mousemove', resetInactivityTimer);
        document.addEventListener('keypress', resetInactivityTimer);
        document.addEventListener('click', resetInactivityTimer);
        document.addEventListener('scroll', resetInactivityTimer);

        // Initialize timer
        resetInactivityTimer();

        // Confirm before leaving page
        window.addEventListener('beforeunload', function(e) {
            const message = 'Are you sure you want to leave? Your vault session will be terminated.';
            e.returnValue = message;
            return message;
        });

        // Add download tracking for audit
        document.querySelectorAll('a[href*="download_file"]').forEach(link => {
            link.addEventListener('click', function() {
                console.log(`File download: ${this.href}`);
                // Could send audit log entry for file access
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+L or Cmd+L for logout
            if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                e.preventDefault();
                if (confirm('Log out securely?')) {
                    window.location.href = '{{ url_for("logout") }}';
                }
            }
            
            // Escape key for quick logout
            if (e.key === 'Escape') {
                if (confirm('Press Escape again to log out securely.')) {
                    setTimeout(() => {
                        if (confirm('Final confirmation - log out now?')) {
                            window.location.href = '{{ url_for("logout") }}';
                        }
                    }, 1000);
                }
            }
        });

        // Security indicator
        let securityIndicator = document.createElement('div');
        securityIndicator.style.position = 'fixed';
        securityIndicator.style.bottom = '20px';
        securityIndicator.style.right = '20px';
        securityIndicator.style.background = '{{ "var(--bs-success)" if vault_type == "real" else "var(--bs-info)" }}';
        securityIndicator.style.color = 'white';
        securityIndicator.style.padding = '8px 12px';
        securityIndicator.style.borderRadius = '20px';
        securityIndicator.style.fontSize = '12px';
        securityIndicator.style.zIndex = '1000';
        securityIndicator.innerHTML = `<i class="fas fa-{{ "shield-alt" if vault_type == "real" else "mask" }} me-1"></i>{{ vault_type|title }} Active`;
        document.body.appendChild(securityIndicator);
    </script>
</body>
</html>
